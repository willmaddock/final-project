<p style="color: green"><%= notice %></p>

<h1>Access Points</h1>

<% if flash[:alert] %>
  <div class="alert alert-danger"><%= flash[:alert] %></div>
<% end %>

<% if flash[:notice] %>
  <div class="alert alert-success"><%= flash[:notice] %></div>
<% end %>

<%= link_to 'New Access Point', new_access_point_path, class: 'btn btn-primary mb-3' %>

<%# Define role-specific messages for access points %>
<% role_benefits = {
  "shipping_agent" => "Allows viewing and managing access points with detailed descriptions and status updates.",
  "viewer" => "Provides visibility into access points and their status within the platform.",
  "logistics_manager" => "Grants control over access points, with the ability to monitor and update statuses.",
  "admin" => "Central to managing and updating all access points, including adding, editing, and deleting.",
  "editor" => "Facilitates editing access points and updating their descriptions and statuses."
} %>

<%# Display the message for the current userâ€™s role %>
<% if user_signed_in? && role_benefits.key?(current_user.role) %>
  <div class="alert alert-info">
    <%= role_benefits[current_user.role] %>
  </div>
<% end %>

<!-- Combined Filtering and Records per Page Form in a Row -->
<%= form_with(url: access_points_path, method: :get, local: true) do |form| %>
  <div class="d-flex align-items-center mb-3">
    <div class="me-3">
      <%= form.label :location, "Location:", class: "form-label" %>
      <%= form.select :location, AccessPoint.select(:location).distinct.map { |ap| [ap.location, ap.location] },
                      { include_blank: 'Select Location' },
                      { class: 'form-control' } %>
    </div>
    <div class="me-3">
      <%= form.label :access_level, "Access Level:", class: "form-label" %>
      <%= form.select :access_level, AccessPoint.select(:access_level).distinct.map { |ap| [ap.access_level, ap.access_level] },
                      { include_blank: 'Select Access Level' },
                      { class: 'form-control' } %>
    </div>
    <div class="me-3">
      <%= form.label :status, "Status:", class: "form-label" %>
      <%= form.select :status, [['Active', true], ['Inactive', false]],
                      { include_blank: 'Select Status' },
                      { class: 'form-control' } %>
    </div>
    <div>
      <%= form.label :per_page, "Records per page:", class: "form-label" %>
      <%= form.select :per_page, [10, 20, 30], { selected: params[:per_page] || 10 },
                      { class: "form-select" } %>
    </div>
    <div class="ms-3">
      <%= form.submit "Filter", class: 'btn btn-primary' %>
    </div>
  </div>
<% end %>

<div class="table-responsive">
  <table class="table table-striped">
    <thead>
    <tr>
      <th>Location</th>
      <th>Access Level</th>
      <th>Description</th>
      <th>Status</th>
      <th colspan="3" class="text-center">Actions</th>
    </tr>
    </thead>

    <tbody>
    <% @access_points.each do |access_point| %>
      <tr>
        <td><%= access_point.location %></td>
        <td><%= access_point.access_level %></td>
        <td><%= access_point.description %></td>
        <td><span class="<%= access_point.status ? 'text-success' : 'text-danger' %>">
            <%= access_point.status ? 'Active' : 'Inactive' %>
          </span></td>
        <td><%= link_to 'Show', access_point, class: 'btn btn-info' %></td>
        <td><%= link_to 'Edit', edit_access_point_path(access_point), class: 'btn btn-warning' %></td>
        <td>
          <%= link_to 'Delete', access_point, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' %>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
</div>

<% if @access_points.empty? %>
  <div class="alert alert-warning" role="alert">
    No access points found matching your criteria.
  </div>
<% end %>

<%= paginate @access_points %>