<p style="color: green"><%= notice %></p>

<h1>Profiles</h1>

<% if flash[:alert] %>
  <div class="alert alert-danger"><%= flash[:alert] %></div>
<% end %>

<% if flash[:notice] %>
  <div class="alert alert-success"><%= flash[:notice] %></div>
<% end %>

<%= link_to 'New Profile', new_profile_path, class: 'btn btn-primary mb-3' %>

<%# Role-specific messages for profiles %>
<% role_benefits = {
  "shipping_agent" => "Manage profile details and associated items efficiently.",
  "viewer" => "View profiles and associated data with read-only access.",
  "logistics_manager" => "Oversee profile creation and updates for all users.",
  "admin" => "Manage all aspects of profiles, including creating, editing, and deleting.",
  "editor" => "Edit profile details as needed."
} %>

<% if user_signed_in? && role_benefits.key?(current_user.role) %>
  <div class="alert alert-info">
    <%= role_benefits[current_user.role] %>
  </div>
<% end %>

<!-- Filtering Form -->
<%= form_with(url: profiles_path, method: :get, local: true) do |form| %>
  <div class="d-flex align-items-center mb-3">
    <div class="me-3">
      <%= form.label :username, "Username:", class: "form-label text-light" %>
      <%= form.select :username, User.pluck(:username).uniq, { include_blank: 'Select Username' },
                      { class: 'form-control', onchange: 'this.form.submit();' } %>
    </div>
    <div class="me-3">
      <%= form.label :location, "Location:", class: "form-label text-light" %>
      <%= form.select :location, Profile.pluck(:location).uniq, { include_blank: 'Select Location' },
                      { class: 'form-control', onchange: 'this.form.submit();' } %>
    </div>
    <div class="me-3">
      <%= form.label :email, "Email:", class: "form-label text-light" %>
      <%= form.select :email, User.pluck(:email).uniq, { include_blank: 'Select Email' },
                      { class: 'form-control', onchange: 'this.form.submit();' } %>
    </div>
    <div>
      <%= form.label :per_page, "Profiles per page:", class: "form-label text-light" %>
      <%= form.select :per_page, [12, 24, 36, 48], { selected: params[:per_page] || 12 },
                      { class: "form-control", onchange: 'this.form.submit();' } %>
      <%= hidden_field_tag :page, params[:page] %>
    </div>
  </div>
<% end %>

<!-- Profile Cards -->
<% if @profiles.empty? %>
  <div class="alert alert-warning" role="alert">
    No profiles found matching your criteria.
  </div>
<% else %>
  <div id="profiles" class="d-flex flex-wrap">
    <% @profiles.each do |profile| %>
      <div class="profile card m-2" style="width: 18rem;">
        <%= render profile %> <!-- Assuming the profile partial renders relevant details -->
        <div class="card-body">
          <p><%= link_to "Show this profile", profile, class: "btn btn-info" %></p>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<!-- Pagination Controls -->
<div class="pagination mt-4 d-flex justify-content-between align-items-center">
  <% if @profiles.prev_page %>
    <%= link_to 'Previous', profiles_path(page: @profiles.prev_page, per_page: params[:per_page]), class: 'btn btn-secondary' %>
  <% end %>

  <span>Page <%= @profiles.current_page %> of <%= @profiles.total_pages %></span>

  <% if @profiles.next_page %>
    <%= link_to 'Next', profiles_path(page: @profiles.next_page, per_page: params[:per_page]), class: 'btn btn-secondary' %>
  <% end %>
</div>